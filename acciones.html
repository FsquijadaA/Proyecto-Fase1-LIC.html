<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pokémon Bank - Acciones</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <!-- Estilos personalizados -->
  <link rel="stylesheet" href="estilos.css">
</head>
<body>
  <div class="container">
    <!-- Logo del banco -->
    <div class="text-center">
      <img src="logo-pokemon-bank.png" alt="Logo Pokémon Bank" class="logo my-4">
    </div>

    <!-- Cabecera con nombre del usuario y número de cuenta -->
    <div class="header mb-4">
      <h2 class="mb-0">Bienvenido, <span id="userName"></span></h2>
      <small>Número de cuenta: <span id="accountNumber"></span></small>
    </div>

    <!-- Menú de acciones secundarias con estilos distintivos y reordenados -->
    <div class="action-menu">
      <div class="list-group mb-3">
        <a href="transacciones.html" class="list-group-item list-group-item-action special-action">Ver historial de transacciones</a>
        <a href="graficos.html" class="list-group-item list-group-item-action special-action">Ver gráfico de transacciones</a>
      </div>
    </div>

    <!-- Menú de acciones principales -->
    <div class="action-menu">
      <div class="list-group">
        <a href="#" class="list-group-item list-group-item-action" data-toggle="modal" data-target="#depositModal">Depositar</a>
        <a href="#" class="list-group-item list-group-item-action" data-toggle="modal" data-target="#withdrawModal">Retirar</a>
        <a href="#" class="list-group-item list-group-item-action" data-toggle="modal" data-target="#balanceModal">Consultar Saldo</a>
        <a href="#" class="list-group-item list-group-item-action" data-toggle="modal" data-target="#payServicesModal">Pagar Servicios</a>
      </div>
    </div>
    
    <!-- Botón de Cerrar Sesión con estilo más destacado y tamaño reducido -->
    <div class="d-flex justify-content-center mt-3">
      <a href="login.html" class="btn btn-danger btn-sm exit-button">Cerrar Sesión</a>
    </div>

  </div>
   <!-- Modales para cada acción -->
  <!-- Modal para Depositar -->
<div class="modal fade" id="depositModal" tabindex="-1" role="dialog" aria-labelledby="depositModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="depositModalLabel">Depositar</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="deposit-form">
            <div class="form-group">
              <label for="depositAmount">Cantidad a depositar:</label>
              <input type="number" class="form-control" id="depositAmount" placeholder="Ingresa la cantidad" min="0">
            </div>
            <button type="submit" class="btn btn-primary">Realizar Depósito</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal para Retirar -->
  <div class="modal fade" id="withdrawModal" tabindex="-1" role="dialog" aria-labelledby="withdrawModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="withdrawModalLabel">Retirar</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="withdraw-form">
            <div class="form-group">
              <label for="withdrawAmount">Cantidad a retirar:</label>
              <input type="number" class="form-control" id="withdrawAmount" placeholder="Ingresa la cantidad" min="0">
            </div>
            <button type="submit" class="btn btn-primary">Realizar Retiro</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal para Consultar Saldo -->
  <div class="modal fade" id="balanceModal" tabindex="-1" role="dialog" aria-labelledby="balanceModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="balanceModalLabel">Consulta de Saldo</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Tu saldo actual es: <strong id="currentBalance">$0.00</strong> <!-- Este valor se actualizaría con JavaScript -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal para Pagar Servicios -->
  <div class="modal fade" id="payServicesModal" tabindex="-1" role="dialog" aria-labelledby="payServicesModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="payServicesModalLabel">Pago de Servicios</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="services-payment-form">
            <div class="form-group">
              <label for="serviceType">Tipo de servicio:</label>
              <select class="form-control" id="serviceType">
                <option value="electricity">Energía Eléctrica</option>
                <option value="internet">Internet</option>
                <option value="phone">Telefonía</option>
                <option value="water">Agua Potable</option>
              </select>
            </div>
            <div class="form-group">
              <label for="paymentAmount">Cantidad a pagar:</label>
              <input type="number" class="form-control" id="paymentAmount" placeholder="Ingresa la cantidad" min="0">
            </div>
            <button type="submit" class="btn btn-primary">Realizar Pago</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap y jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
  <!-- Biblioteca para SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Biblioteca para jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>

  <script>
    // Obtener los datos almacenados en el localStorage y mostrarlos en la página
    document.addEventListener('DOMContentLoaded', function() {
      var username = localStorage.getItem('username');
      var accountNumber = localStorage.getItem('accountNumber');
      var balance = localStorage.getItem('balance');

      if (username) {
        document.getElementById('userName').innerText = username;
      }
      if (accountNumber) {
        document.getElementById('accountNumber').innerText = accountNumber;
      }
      if (balance) {
        document.getElementById('currentBalance').innerText = `$${parseFloat(balance).toFixed(2)}`;
      }
    });

    // Logo en base64 reducido
    const logoBase64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA...'; // Aquí va una cadena base64 más corta

    // Función para descargar PDF usando jsPDF
    function downloadPDF(transactionDetails) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Título
      doc.setFontSize(18);
      doc.text('Pokémon Bank', 105, 20, null, null, 'center');
      doc.setFontSize(14);
      doc.text('Comprobante de Transacción', 105, 30, null, null, 'center');

      // Logo
      doc.addImage(logoBase64, 'PNG', 10, 10, 30, 30);

      // Detalles de la transacción
      doc.setFontSize(12);
      doc.text(transactionDetails, 10, 60);

      // Fecha y hora
      const date = new Date();
      doc.text(`Fecha: ${date.toLocaleDateString()}`, 10, 80);
      doc.text(`Hora: ${date.toLocaleTimeString()}`, 10, 90);

      doc.save('transaction.pdf');
    }

    // Función para almacenar transacciones
    function storeTransaction(type, amount) {
      const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
      const date = new Date().toISOString();
      transactions.push({ type, amount, date });
      localStorage.setItem('transactions', JSON.stringify(transactions));
    }

    // Manejo del formulario de depósito
    document.getElementById('deposit-form').addEventListener('submit', function(e) {
      e.preventDefault();
      var amount = parseFloat(document.getElementById('depositAmount').value);
      if (amount > 0) {
        var balance = parseFloat(localStorage.getItem('balance')) + amount;
        localStorage.setItem('balance', balance.toFixed(2));
        document.getElementById('currentBalance').innerText = `$${balance.toFixed(2)}`;

        storeTransaction('deposit', amount);

        Swal.fire({
          icon: 'success',
          title: 'Depósito Exitoso',
          text: `Has depositado $${amount.toFixed(2)}`,
          showCancelButton: true,
          confirmButtonText: 'Descargar Comprobante',
          cancelButtonText: 'Cerrar'
        }).then((result) => {
          if (result.isConfirmed) {
            downloadPDF(`Transacción: Depósito\nCantidad: $${amount.toFixed(2)}\nSaldo actual: $${balance.toFixed(2)}`);
          }
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'La cantidad debe ser mayor a 0'
        });
      }
    });

    // Manejo del formulario de retiro
    document.getElementById('withdraw-form').addEventListener('submit', function(e) {
      e.preventDefault();
      var amount = parseFloat(document.getElementById('withdrawAmount').value);
      var balance = parseFloat(localStorage.getItem('balance'));
      if (amount > 0 && amount <= balance) {
        balance -= amount;
        localStorage.setItem('balance', balance.toFixed(2));
        document.getElementById('currentBalance').innerText = `$${balance.toFixed(2)}`;

        storeTransaction('withdraw', amount);

        Swal.fire({
          icon: 'success',
          title: 'Retiro Exitoso',
          text: `Has retirado $${amount.toFixed(2)}`,
          showCancelButton: true,
          confirmButtonText: 'Descargar Comprobante',
          cancelButtonText: 'Cerrar'
        }).then((result) => {
          if (result.isConfirmed) {
            downloadPDF(`Transacción: Retiro\nCantidad: $${amount.toFixed(2)}\nSaldo actual: $${balance.toFixed(2)}`);
          }
        });
      } else if (amount > balance) {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'No tienes suficiente saldo'
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'La cantidad debe ser mayor a 0'
        });
      }
    });

    // Manejo del formulario de pago de servicios
    document.getElementById('services-payment-form').addEventListener('submit', function(e) {
      e.preventDefault();
      var amount = parseFloat(document.getElementById('paymentAmount').value);
      var service = document.getElementById('serviceType').value;
      var balance = parseFloat(localStorage.getItem('balance'));
      if (amount > 0 && amount <= balance) {
        balance -= amount;
        localStorage.setItem('balance', balance.toFixed(2));
        document.getElementById('currentBalance').innerText = `$${balance.toFixed(2)}`;

        storeTransaction('payment', amount);

        Swal.fire({
          icon: 'success',
          title: 'Pago Exitoso',
          text: `Has pagado $${amount.toFixed(2)} por ${service}`,
          showCancelButton: true,
          confirmButtonText: 'Descargar Comprobante',
          cancelButtonText: 'Cerrar'
        }).then((result) => {
          if (result.isConfirmed) {
            downloadPDF(`Transacción: Pago de Servicio\nServicio: ${service}\nCantidad: $${amount.toFixed(2)}\nSaldo actual: $${balance.toFixed(2)}`);
          }
        });
      } else if (amount > balance) {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'No tienes suficiente saldo'
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'La cantidad debe ser mayor a 0'
        });
      }
    });
  </script>
</body>
</html>
